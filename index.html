<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ç¨‹è«‹æ¬¾å–®ç³»çµ±</title>
    <style>
        :root {
            --primary: #27ae60;
            --primary-hover: #219150;
            --bg: #f4f7f6;
            --text: #333;
            --border: #ddd;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 20px;
            color: var(--text);
            line-height: 1.5;
        }

        .container { 
            width: 100%;
            max-width: 800px; /* é›»è…¦ç‰ˆæœ€å¤§å¯¬åº¦ */
            margin: 0 auto; 
            background: white; 
            padding: 40px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            border-radius: 8px;
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒæ’ç ´å¯¬åº¦ */
        }

        /* --- è¼¸å…¥å€å¡Š (æ“ä½œä»‹é¢) --- */
        .no-print { 
            background: #eef2f3; 
            padding: 25px; 
            margin-bottom: 30px; 
            border: 1px solid #ccc; 
            border-radius: 8px; 
        }

        h1, h2 { text-align: center; color: #2c3e50; margin-top: 0; }
        
        .input-group { 
            margin-bottom: 15px; 
            display: flex; 
            align-items: center; 
            gap: 10px;
        }

        label { 
            width: 100px; 
            font-weight: bold; 
            flex-shrink: 0; /* é˜²æ­¢æ¨™ç±¤è¢«å£“ç¸® */
        }

        input, select { 
            flex: 1; 
            padding: 10px; 
            border: 1px solid var(--border); 
            border-radius: 4px; 
            font-size: 16px; /* é˜²æ­¢ iOS è‡ªå‹•ç¸®æ”¾ */
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button { 
            width: 100%; 
            padding: 12px; 
            background: var(--primary); 
            color: white; 
            border: none; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: bold;
            border-radius: 4px; 
            transition: background 0.2s;
        }

        button:hover { background: var(--primary-hover); }
        
        button.print-btn { background: #34495e; }
        button.print-btn:hover { background: #2c3e50; }

        /* --- è¼¸å‡ºå€å¡Š (è«‹æ¬¾å–®é è¦½) --- */
        #invoiceArea {
            border-top: 2px dashed #ccc;
            padding-top: 20px;
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap; /* å…è¨±æ›è¡Œ */
            gap: 20px;
        }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #000; padding: 12px; text-align: left; }
        th { background: #f0f0f0; text-align: center; white-space: nowrap; }
        
        .text-right { text-align: right; }
        
        .bank-info {
            margin-top: 30px;
            padding: 15px;
            border: 2px dashed #333;
            background: #fffdf0;
        }

        .footer { 
            margin-top: 50px; 
            display: flex; 
            justify-content: space-between; 
            gap: 20px;
        }
        
        .sign-box {
            border-top: 1px solid #000;
            width: 40%;
            padding-top: 10px;
            text-align: center;
        }

        /* --- æ‰‹æ©Ÿç‰ˆ RWD èª¿æ•´ (è¢å¹•å°æ–¼ 600px æ™‚è§¸ç™¼) --- */
        @media (max-width: 600px) {
            body { padding: 10px; }
            .container { padding: 20px; }
            
            /* è¼¸å…¥å€è®Šç‚ºå‚ç›´æ’åˆ— */
            .input-group { 
                flex-direction: column; 
                align-items: flex-start; 
                gap: 5px;
            }
            label { width: 100%; }
            input, select { width: 100%; box-sizing: border-box; }

            /* è«‹æ¬¾å–®é ­éƒ¨å‚ç›´æ’åˆ— */
            .invoice-header {
                flex-direction: column;
                gap: 10px;
            }
            .invoice-header div { text-align: left !important; }

            /* è¡¨æ ¼èª¿æ•´å­—é«”ä»¥é©æ‡‰çª„è¢å¹• */
            th, td { padding: 8px; font-size: 14px; }
            
            /* ç°½åæ¬„ä½å †ç–Š */
            .footer { flex-direction: column; gap: 40px; }
            .sign-box { width: 100%; text-align: left; }
        }

        /* --- åˆ—å°å°ˆç”¨æ¨£å¼ (A4 æ ¼å¼) --- */
        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .container { 
                box-shadow: none; 
                margin: 0; 
                width: 100%; 
                max-width: 100%; 
                padding: 0; 
                border: none;
            }
            #invoiceArea { border-top: none; padding-top: 0; }
            
            /* å¼·åˆ¶åˆ—å°æ™‚ä½¿ç”¨æ©«å‘æ’åˆ—ï¼Œå³ä½¿æ˜¯åœ¨æ‰‹æ©Ÿä¸ŠæŒ‰åˆ—å° */
            .invoice-header { flex-direction: row !important; }
            .invoice-header div { width: 50%; }
            .invoice-header div:last-child { text-align: right !important; }
            
            .footer { flex-direction: row !important; margin-top: 80px; }
            .sign-box { width: 40%; text-align: center !important; }
            
            .bank-info { background: none; border: 2px solid #000; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="no-print">
        <h2>ğŸ› ï¸ å»ºç«‹è«‹æ¬¾å–®</h2>
        <div class="input-group">
            <label>å®¢æˆ¶åç¨±</label>
            <input type="text" id="client" placeholder="ä¾‹ï¼šé™³å…ˆç”Ÿ">
        </div>
        <div class="input-group">
            <label>å·¥ç¨‹åœ°é»</label>
            <input type="text" id="location" placeholder="ä¾‹ï¼šæ¿æ©‹æ–‡åŒ–è·¯æ¡ˆ">
        </div>
        <div class="input-group">
            <label>å·¥ç¨‹ç¸½åƒ¹</label>
            <input type="number" id="totalPrice" placeholder="è¼¸å…¥ç¸½å ±åƒ¹é‡‘é¡">
        </div>
        <div class="input-group">
            <label>è«‹æ¬¾æœŸæ•¸</label>
            <select id="phase" onchange="updateRatio()">
                <option value="1">ç¬¬ä¸€æœŸï¼šç°½ç´„è¨‚é‡‘ (30%)</option>
                <option value="2">ç¬¬äºŒæœŸï¼šé–‹å·¥é€²å ´ (30%)</option>
                <option value="3">ç¬¬ä¸‰æœŸï¼šæœ¨ä½œå®Œå·¥ (30%)</option>
                <option value="4">ç¬¬å››æœŸï¼šé©—æ”¶å°¾æ¬¾ (10%)</option>
            </select>
        </div>
        <div class="input-group">
            <label>æœ¬æœŸæ¯”ä¾‹ %</label>
            <input type="number" id="ratio" value="30">
        </div>
        
        <div class="btn-group">
            <button onclick="generateInvoice()">ç”Ÿæˆè«‹æ¬¾å–®</button>
            <button class="print-btn" onclick="window.print()">åˆ—å° / å­˜ PDF</button>
        </div>
    </div>

    <div id="invoiceArea">
        <h1>å·¥ç¨‹è«‹æ¬¾å–®</h1>
        <div class="invoice-header">
            <div>
                <p><strong>å®¢æˆ¶åç¨±ï¼š</strong><span id="outClient"></span></p>
                <p><strong>å·¥ç¨‹åœ°é»ï¼š</strong><span id="outLoc"></span></p>
            </div>
            <div style="text-align: right;">
                <p><strong>è«‹æ¬¾æ—¥æœŸï¼š</strong><span id="outDate"></span></p>
                <p><strong>å–®æ“šç·¨è™Ÿï¼š</strong><span id="outId"></span></p>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>é …ç›®èªªæ˜</th>
                    <th width="25%">é‡‘é¡ (NTD)</th>
                    <th width="20%">å‚™è¨»</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <strong>å·¥ç¨‹ç¸½åƒ¹</strong>
                    </td>
                    <td class="text-right" id="outTotal">0</td>
                    <td></td>
                </tr>
                <tr>
                    <td>
                        <strong>æœ¬æ¬¡è«‹æ¬¾ï¼š<span id="outPhaseName">ç°½ç´„è¨‚é‡‘</span></strong>
                        <br><span style="font-size:0.9em; color:#666;">(ä¾ç…§å·¥ç¨‹åˆç´„æ¯”ä¾‹ <span id="outRatio">30</span>% è¨ˆç®—)</span>
                    </td>
                    <td class="text-right" id="outAmount" style="font-weight:bold; font-size: 1.1em;">0</td>
                    <td>å«ç¨…</td>
                </tr>
            </tbody>
        </table>

        <div class="bank-info">
            <h3 style="margin-top: 0;">åŒ¯æ¬¾è³‡è¨Š</h3>
            <p>éŠ€è¡Œä»£ç¢¼ï¼š<strong>000 (XXéŠ€è¡Œ)</strong></p>
            <p>éŠ€è¡Œå¸³è™Ÿï¼š<strong>1234-5678-9012</strong></p>
            <p>æˆ¶åï¼š<strong>(æ‚¨çš„å…¬å¸åç¨±)</strong></p>
        </div>

        <div class="footer">
            <div class="sign-box">ç¶“è¾¦äºº</div>
            <div class="sign-box">å®¢æˆ¶ç°½æ”¶</div>
        </div>
    </div>
</div>

<script>
    function updateRatio() {
        const phase = document.getElementById('phase').value;
        const ratios = {1: 30, 2: 30, 3: 30, 4: 10};
        document.getElementById('ratio').value = ratios[phase];
    }

    function format(n) {
        return parseInt(n).toLocaleString('zh-TW');
    }

    function generateInvoice() {
        const client = document.getElementById('client').value || "(æœªå¡«å¯«)";
        const location = document.getElementById('location').value || "(æœªå¡«å¯«)";
        const total = document.getElementById('totalPrice').value || 0;
        const ratio = document.getElementById('ratio').value;
        const phaseSelect = document.getElementById('phase');
        const phaseName = phaseSelect.options[phaseSelect.selectedIndex].text.split('ï¼š')[1].split(' (')[0];

        const amount = Math.round(total * (ratio / 100));

        // å¡«å…¥è³‡æ–™
        document.getElementById('outClient').innerText = client;
        document.getElementById('outLoc').innerText = location;
        document.getElementById('outDate').innerText = new Date().toLocaleDateString();
        // ç”¢ç”Ÿéš¨æ©Ÿç·¨è™Ÿï¼šIV-æ—¥æœŸ-äº‚æ•¸
        document.getElementById('outId').innerText = 'IV-' + new Date().toISOString().slice(2,10).replace(/-/g,"") + Math.floor(Math.random()*100);
        
        document.getElementById('outTotal').innerText = '$' + format(total);
        document.getElementById('outPhaseName').innerText = phaseName;
        document.getElementById('outRatio').innerText = ratio;
        document.getElementById('outAmount').innerText = '$' + format(amount);

        // æ²å‹•åˆ°è«‹æ¬¾å–®ä½ç½® (æ‰‹æ©Ÿä¸Šé«”é©—è¼ƒå¥½)
        document.getElementById('invoiceArea').scrollIntoView({ behavior: 'smooth' });
    }

    // åˆå§‹åŒ–æ—¥æœŸ
    document.getElementById('outDate').innerText = new Date().toLocaleDateString();
</script>

</body>
</html>
