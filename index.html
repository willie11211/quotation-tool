<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å» å•†å·¥ç¨‹ä¼°åƒ¹ç³»çµ± (ä¹™æ–¹å°ˆç”¨)</title>
    <style>
        :root {
            --header-bg: #2c3e50;
            --section-bg: #ffffff;
            --highlight: #2980b9;
            --border: #bdc3c7;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif;
            background-color: #ecf0f1;
            margin: 0;
            padding: 20px;
            color: #333;
            line-height: 1.5;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: var(--section-bg);
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        
        /* --- è¼¸å…¥ä»‹é¢ RWD --- */
        .panel {
            border: 1px solid var(--border);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            background: #fff;
        }
        .panel-header {
            background-color: #f7f9fa;
            padding: 12px 15px;
            margin: -20px -20px 20px -20px;
            border-bottom: 1px solid var(--border);
            font-weight: bold;
            color: var(--header-bg);
            border-radius: 8px 8px 0 0;
            font-size: 1.1rem;
        }
        h1 { color: var(--header-bg); margin-top: 0; text-align: center; }
        
        /* ç¶²æ ¼ç³»çµ± */
        .grid-2, .grid-4 { display: grid; gap: 15px; }
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }
        
        /* è¡¨å–®å…ƒä»¶ */
        label { display: block; font-size: 0.95rem; margin-bottom: 5px; color: #555; font-weight: 600; }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px; /* é˜²æ­¢ iPhone ç¸®æ”¾ */
        }
        input:focus, select:focus { border-color: var(--highlight); outline: none; box-shadow: 0 0 5px rgba(41, 128, 185, 0.3); }

        .sub-title {
            margin: 15px 0 10px 0;
            border-left: 5px solid var(--highlight);
            padding-left: 10px;
            font-size: 1.1em;
            color: var(--header-bg);
        }

        .action-btn {
            background-color: var(--highlight);
            color: white;
            border: none;
            padding: 15px;
            font-size: 1.1rem;
            cursor: pointer;
            width: 100%;
            border-radius: 4px;
            font-weight: bold;
            transition: background 0.3s;
        }
        .action-btn:hover { background-color: #1f618d; }

        /* --- å ±åƒ¹å–®é è¦½ä»‹é¢ --- */
        #quotePreview {
            display: none;
            margin-top: 40px;
            border-top: 4px solid var(--header-bg);
            padding-top: 20px;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .quote-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            flex-wrap: wrap;
            gap: 20px;
        }
        .quote-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }
        .quote-table th {
            background-color: #eee;
            border: 1px solid #000;
            padding: 10px;
            text-align: center;
        }
        .quote-table td {
            border: 1px solid #000;
            padding: 10px;
        }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        
        .total-section {
            margin-top: 20px;
            text-align: right;
            background: #fff;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .total-line { font-size: 1.1rem; margin: 5px 0; }
        .grand-total { font-size: 1.6rem; font-weight: bold; color: #c0392b; margin-top: 10px; border-top: 2px solid #ddd; padding-top: 10px; }

        .btn-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        .print-btn { background: #27ae60; color: white; border: none; padding: 12px 25px; border-radius: 4px; cursor: pointer; font-size: 1rem; }
        .back-btn { background: #7f8c8d; color: white; border: none; padding: 12px 25px; border-radius: 4px; cursor: pointer; font-size: 1rem; }

        /* --- æ‰‹æ©Ÿç‰ˆ RWD (è¢å¹•å°æ–¼ 768px) --- */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 15px; }
            
            /* è¼¸å…¥æ¬„ä½è®Šå‚ç›´å †ç–Š */
            .grid-2, .grid-4 { grid-template-columns: 1fr; gap: 10px; }
            
            /* å ±åƒ¹å–®é è¦½èª¿æ•´ */
            .quote-header { flex-direction: column; gap: 10px; }
            .quote-header div { text-align: left !important; width: 100%; }
            
            /* è¡¨æ ¼æ–‡å­—ç¸®å°èˆ‡æ²å‹• */
            .quote-table { font-size: 0.85rem; }
            .quote-table th, .quote-table td { padding: 6px; }
            /* éš±è—è¼ƒä¸é‡è¦çš„æ¬„ä½ä»¥ç¯€çœç©ºé–“ (æ‰‹æ©Ÿä¸Š) */
            .quote-table th:nth-child(4), .quote-table td:nth-child(4) { display: none; } /* éš±è—å–®ä½ */
        }

        /* --- åˆ—å°å°ˆç”¨æ¨£å¼ (å¼·åˆ¶ A4 æ ¼å¼) --- */
        @media print {
            body { background: white; padding: 0; }
            .no-print { display: none !important; }
            .container { box-shadow: none; border: none; padding: 0; width: 100%; max-width: none; }
            #quotePreview { display: block !important; border: none; margin: 0; animation: none; }
            
            /* é‚„åŸè¡¨æ ¼é¡¯ç¤º */
            .quote-table { font-size: 12pt; width: 100%; }
            .quote-table th:nth-child(4), .quote-table td:nth-child(4) { display: table-cell !important; }
            .quote-table th { background-color: #ddd !important; -webkit-print-color-adjust: exact; }
            
            /* å¼·åˆ¶æ©«å‘æ’åˆ—é ­éƒ¨ */
            .quote-header { flex-direction: row !important; }
            .quote-header div { width: 50%; }
            .quote-header div:last-child { text-align: right !important; }
            
            .total-section { border: none; padding: 0; }
        }
    </style>
</head>
<body>

<div class="container">
    
    <div class="no-print">
        <h1>ğŸ› ï¸ å» å•†å·¥ç¨‹ä¼°åƒ¹ç³»çµ±</h1>
        
        <div class="panel">
            <div class="panel-header">1. æ¡ˆå ´åŸºæœ¬è³‡æ–™</div>
            <div class="grid-2">
                <div>
                    <label>å®¢æˆ¶åç¨± (ä¸™æ–¹)</label>
                    <input type="text" id="clientName" placeholder="ä¾‹å¦‚ï¼šé™³å…ˆç”Ÿ">
                </div>
                <div>
                    <label>æ¡ˆå ´åœ°å€ / ä»£è™Ÿ</label>
                    <input type="text" id="projectLoc" placeholder="ä¾‹å¦‚ï¼šæ¿æ©‹æ–‡åŒ–è·¯æ¡ˆ">
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">2. ä¸ˆé‡æ•¸æ“šèˆ‡è¦æ ¼è¼¸å…¥</div>
            
            <div class="sub-title">A. å¤©èŠ±æ¿å·¥ç¨‹</div>
            <div class="grid-4">
                <div>
                    <label>å¹³é‡˜å¤©èŠ± (åª)</label>
                    <input type="number" id="qty_ceiling_flat" min="0" placeholder="0">
                </div>
                <div>
                    <label>é€ å‹å¤©èŠ± (åª)</label>
                    <input type="number" id="qty_ceiling_style" min="0" placeholder="0">
                </div>
                <div>
                    <label>é–“ç…§å±¤æ¿ (å°º)</label>
                    <input type="number" id="qty_ceiling_light" min="0" placeholder="0">
                </div>
                <div>
                    <label>é–‹å­”/ç¶­ä¿® (å¼)</label>
                    <input type="number" id="qty_ceiling_hole" min="0" placeholder="0">
                </div>
            </div>

            <div class="sub-title">B. æ«ƒé«”å·¥ç¨‹</div>
            <div class="grid-2">
                <div>
                    <label>æ«ƒé«”å·¥æ³•</label>
                    <select id="opt_cabinet_type">
                        <option value="system">ç³»çµ±æ«ƒ (System)</option>
                        <option value="wood">æœ¨ä½œæ«ƒ (Woodwork)</option>
                    </select>
                </div>
                <div>
                    <label>äº”é‡‘ç­‰ç´š</label>
                    <select id="opt_hardware_level">
                        <option value="normal">æ¨™æº–äº”é‡‘</option>
                        <option value="premium">é€²å£ç·©è¡ (+15%)</option>
                    </select>
                </div>
            </div>
            <div class="grid-4" style="margin-top:10px;">
                <div>
                    <label>çŸ®æ«ƒ â‰¤120cm (å°º)</label>
                    <input type="number" id="qty_cab_low" min="0" placeholder="0">
                </div>
                <div>
                    <label>é«˜æ«ƒ >120cm (å°º)</label>
                    <input type="number" id="qty_cab_high" min="0" placeholder="0">
                </div>
                <div>
                    <label>åŠ è³¼æŠ½å±œ (çµ„)</label>
                    <input type="number" id="qty_cab_drawer" min="0" placeholder="0">
                </div>
            </div>

            <div class="sub-title">C. éš”é–“èˆ‡æ‹†é™¤</div>
            <div class="grid-4">
                <div>
                    <label>é›™é¢éš”é–“ (åª)</label>
                    <input type="number" id="qty_partition" min="0" placeholder="0">
                </div>
                <div>
                    <label>èˆŠè£æ½¢æ‹†é™¤ (åª)</label>
                    <input type="number" id="qty_demo" min="0" placeholder="0">
                </div>
                <div>
                    <label>å»¢æ£„ç‰©æ¸…é‹ (è»Š)</label>
                    <input type="number" id="qty_trash" min="0" placeholder="0">
                </div>
            </div>
        </div>

        <button class="action-btn" onclick="generateQuote()">è¨ˆç®—ä¸¦ç”¢ç”Ÿå ±åƒ¹å–®</button>
    </div>

    <div id="quotePreview">
        <div class="quote-header">
            <div>
                <h2>å·¥ç¨‹å ±åƒ¹å–®</h2>
                <p><strong>å®¢æˆ¶åç¨±ï¼š</strong><span id="out_client"></span></p>
                <p><strong>å·¥ç¨‹åœ°é»ï¼š</strong><span id="out_loc"></span></p>
            </div>
            <div style="text-align: right;">
                <p><strong>å ±åƒ¹å–®è™Ÿï¼š</strong><span id="out_id"></span></p>
                <p><strong>å ±åƒ¹æ—¥æœŸï¼š</strong><span id="out_date"></span></p>
                <p><strong>æ‰¿æ”¬å» å•†ï¼š</strong>(è«‹å¡«å…¬å¸å)</p>
            </div>
        </div>

        <table class="quote-table">
            <thead>
                <tr>
                    <th width="15%">å·¥ç¨®</th>
                    <th width="30%">å·¥é …åç¨±</th>
                    <th width="10%">æ•¸é‡</th>
                    <th width="10%">å–®ä½</th>
                    <th width="15%" class="text-right">å–®åƒ¹</th>
                    <th width="20%" class="text-right">è¤‡åƒ¹</th>
                </tr>
            </thead>
            <tbody id="quoteBody">
                </tbody>
        </table>

        <div class="total-section">
            <div class="total-line">åˆè¨ˆé‡‘é¡ï¼š$<span id="out_subtotal">0</span></div>
            <div class="total-line">ç‡Ÿæ¥­ç¨… (5%)ï¼š$<span id="out_tax">0</span></div>
            <div class="grand-total">ç¸½è¨ˆé‡‘é¡ï¼š$<span id="out_total">0</span></div>
        </div>

        <div class="btn-group no-print">
            <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å° / å­˜ PDF</button>
            <button class="back-btn" onclick="document.querySelector('.no-print').scrollIntoView({behavior:'smooth'})">âœï¸ ä¿®æ”¹å…§å®¹</button>
        </div>
    </div>

</div>

<script>
    // --- å¾Œç«¯é‚è¼¯ï¼šå¸‚åƒ¹è³‡æ–™åº« (å¯åœ¨æ­¤èª¿æ•´å–®åƒ¹) ---
    const DB = {
        ceiling: { flat: 4000, style: 6000, light: 450, hole: 150 },
        cabinet_sys: { low: 5000, high: 6500 },
        cabinet_wood: { low: 10000, high: 15000 },
        drawer: 2500,
        partition: 5500,
        demo: 1300,
        trash: 6000,
        premium_rate: 1.15 // é«˜ç´šåŠ æˆ 15%
    };

    function formatNum(n) {
        return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function generateQuote() {
        // 1. è®€å–æ•¸æ“š
        const client = document.getElementById('clientName').value || "æœªå¡«å¯«";
        const loc = document.getElementById('projectLoc').value || "æœªå¡«å¯«";
        const inputs = {
            c_flat: parseFloat(document.getElementById('qty_ceiling_flat').value) || 0,
            c_style: parseFloat(document.getElementById('qty_ceiling_style').value) || 0,
            c_light: parseFloat(document.getElementById('qty_ceiling_light').value) || 0,
            c_hole: parseFloat(document.getElementById('qty_ceiling_hole').value) || 0,
            
            cab_type: document.getElementById('opt_cabinet_type').value,
            hw_level: document.getElementById('opt_hardware_level').value,
            cab_low: parseFloat(document.getElementById('qty_cab_low').value) || 0,
            cab_high: parseFloat(document.getElementById('qty_cab_high').value) || 0,
            cab_drawer: parseFloat(document.getElementById('qty_cab_drawer').value) || 0,
            
            part: parseFloat(document.getElementById('qty_partition').value) || 0,
            demo: parseFloat(document.getElementById('qty_demo').value) || 0,
            trash: parseFloat(document.getElementById('qty_trash').value) || 0,
        };

        // 2. è¨ˆç®—é‚è¼¯
        let items = [];
        let grandTotal = 0;

        // å¤©èŠ±æ¿
        if(inputs.c_flat > 0) items.push({cat:'å¤©èŠ±æ¿', name:'å¹³é‡˜å¤©èŠ±æ¿ (çŸ½é…¸éˆ£)', qty:inputs.c_flat, unit:'åª', price:DB.ceiling.flat});
        if(inputs.c_style > 0) items.push({cat:'å¤©èŠ±æ¿', name:'é€ å‹å¤©èŠ±æ¿', qty:inputs.c_style, unit:'åª', price:DB.ceiling.style});
        if(inputs.c_light > 0) items.push({cat:'å¤©èŠ±æ¿', name:'é–“æ¥ç…§æ˜å±¤æ¿', qty:inputs.c_light, unit:'å°º', price:DB.ceiling.light});
        if(inputs.c_hole > 0) items.push({cat:'å¤©èŠ±æ¿', name:'é–‹å­”å·¥è³‡', qty:inputs.c_hole, unit:'å¼', price:DB.ceiling.hole});

        // æ«ƒé«”
        let isPremium = inputs.hw_level === 'premium';
        let rate = isPremium ? DB.premium_rate : 1.0;
        let basePrice = inputs.cab_type === 'system' ? DB.cabinet_sys : DB.cabinet_wood;
        let typeName = inputs.cab_type === 'system' ? 'ç³»çµ±' : 'æœ¨ä½œ';
        let note = isPremium ? '(å‡ç´š)' : '';

        // è¨ˆç®—å–®åƒ¹ (ç„¡æ¢ä»¶æ¨å»è‡³åä½æ•¸)
        let p_low = Math.floor(basePrice.low * rate / 10) * 10;
        let p_high = Math.floor(basePrice.high * rate / 10) * 10;
        let p_drawer = Math.floor(DB.drawer * (isPremium ? 1.2 : 1) / 10) * 10;

        if(inputs.cab_low > 0) items.push({cat:'æ«ƒé«”', name:`${typeName}çŸ®æ«ƒ ${note}`, qty:inputs.cab_low, unit:'å°º', price:p_low});
        if(inputs.cab_high > 0) items.push({cat:'æ«ƒé«”', name:`${typeName}é«˜æ«ƒ ${note}`, qty:inputs.cab_high, unit:'å°º', price:p_high});
        if(inputs.cab_drawer > 0) items.push({cat:'æ«ƒé«”', name:'æŠ½å±œçµ„', qty:inputs.cab_drawer, unit:'çµ„', price:p_drawer});

        // é›œé …
        if(inputs.part > 0) items.push({cat:'éš”é–“', name:'é›™é¢éš”é–“ç‰†', qty:inputs.part, unit:'åª', price:DB.partition});
        if(inputs.demo > 0) items.push({cat:'æ‹†é™¤', name:'èˆŠè£æ½¢æ‹†é™¤', qty:inputs.demo, unit:'åª', price:DB.demo});
        if(inputs.trash > 0) items.push({cat:'æ¸…æ½”', name:'å»¢æ£„ç‰©æ¸…é‹', qty:inputs.trash, unit:'è»Š', price:DB.trash});

        // 3. è¼¸å‡º HTML
        const tbody = document.getElementById('quoteBody');
        tbody.innerHTML = '';
        
        items.forEach(item => {
            let sub = item.qty * item.price;
            grandTotal += sub;
            tbody.innerHTML += `
                <tr>
                    <td class="text-center">${item.cat}</td>
                    <td>${item.name}</td>
                    <td class="text-center">${item.qty}</td>
                    <td class="text-center">${item.unit}</td>
                    <td class="text-right">$${formatNum(item.price)}</td>
                    <td class="text-right">$${formatNum(sub)}</td>
                </tr>
            `;
        });

        // è™•ç†åˆè¨ˆ
        let tax = Math.round(grandTotal * 0.05);
        let final = grandTotal + tax;

        document.getElementById('out_subtotal').innerText = formatNum(grandTotal);
        document.getElementById('out_tax').innerText = formatNum(tax);
        document.getElementById('out_total').innerText = formatNum(final);

        // å¡«å¯«æª”é ­
        document.getElementById('out_client').innerText = client;
        document.getElementById('out_loc').innerText = loc;
        document.getElementById('out_date').innerText = new Date().toLocaleDateString();
        document.getElementById('out_id').innerText = "Q" + new Date().toISOString().slice(2,10).replace(/-/g,"") + Math.floor(Math.random()*100);

        // é¡¯ç¤ºä¸¦æ²å‹•
        document.getElementById('quotePreview').style.display = 'block';
        document.getElementById('quotePreview').scrollIntoView({behavior:'smooth'});
    }
</script>

</body>
</html>
